# This workflow will run tests using node and then publish a package to GitHub Packages when a release is created
# For more information see: https://help.github.com/actions/language-and-framework-guides/publishing-nodejs-packages

name: npm publish

on:
  release:
    types: [released]

jobs:
  publish-npm:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 24
          registry-url: https://registry.npmjs.org
      - name: Publish package
        run: |
          set -euo pipefail
          VERSION="$(node -p "require('./package.json').version")"
          MAJOR="${VERSION%%.*}"
          TAG_ARG=""
          if [ "$MAJOR" = "2" ]; then
            TAG_ARG="--tag v2"
          fi
          if npm view react-pure-modal@"${VERSION}" version >/dev/null 2>&1; then
            echo "Version ${VERSION} already exists on npm; skipping publish."
            exit 0
          fi
          npm publish --provenance --access public ${TAG_ARG}
